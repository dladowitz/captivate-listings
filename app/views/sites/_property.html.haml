/ Property Section
#property.index-section{"data-url-id" => "property"}
  .promoted-gallery-wrapper

  / Hero Area
  .banner-thumbnail-wrapper.has-description{"data-content-field" => "main-image"}
    .color-overlay
    %figure#thumbnail.loading.content-fill
      %img{"id" => "main-background", "src" => "#{@property.main_background_image_url}", "class" => "section-background", "data-image" => "#{@property.main_background_image_url}", "data-src" => "#{@property.main_background_image_url}", "data-image-dimensions" => "1844x1027", "data-image-focal-point" => "0.5,0.5" }/
    .desc-wrapper{"data-collection-id" => "55f2500fe4b0ce0cd8d12d02"}
      %p
        %strong= @property.address
      %p
        YOU'RE HOME!

  / Property Info Area
  .index-section-wrapper.page-content
    .content-inner.has-content{"data-content-field" => "main-content"}
      #page-55f1b5e5e4b048de91d5ac0e.sqs-layout.sqs-grid-12.columns-12{"data-type" => "page", "data-updated-on" => "1442001331793"}
        .row.sqs-row
          .col.sqs-col-12.span-12

            / Matterport Embed Area
            - if @property.matterport_status == "yes" && !@property.matterport_url.blank?
              #block-yui_3_17_2_10_1441907369577_8038.sqs-block.embed-block.sqs-block-embed{"data-block-json" => "{\"hSize\":null,\"floatDir\":null,\"html\":\"<div id=\\\"my-iframe\\\"><iframe  height=\\\"584\\\" width=\\\"1050\\\" frameborder=\\\"0\\\" allowfullscreen src=\\\"https://my.matterport.com/show/?m=WaRmuinAmY4\\\"></iframe>\\n</div>\",\"resolvedBy\":\"manual\",\"resolved\":true}", "data-block-type" => "22"}
                .sqs-block-content
                  #my-iframe
                    / Matterport Embed URL
                    %iframe{:allowfullscreen => "", "data-embed" => "true", :frameborder => "0", :height => "584", :src => "#{@property.matterport_url}", :width => "1050"}

            / Agent Detals Area
            #block-yui_3_17_2_10_1441907369577_13768.sqs-block.image-block.sqs-block-image.sqs-col-3.span-3.float.float-right{"data-block-type" => "5"}
              .sqs-block-content
                .image-block-outer-wrapper.layout-caption-below
                  .intrinsic{:style => "max-width:356.0px;"}
                    .image-block-wrapper.has-aspect-ratio{ :style => "padding-bottom:121.62921142578125%;" }
                      / Agent Image
                      %img{:src => "#{@property.agent_image_url}", "data-image-dimensions" => "356x433", "data-image-focal-point" => "0.5,0.5", "data-image-id" => "55f24e20e4b0c0afc4503208", "data-load" => "false", "data-type" => "image"}/
                    .image-caption-wrapper
                      .image-caption
                        - unless @property.agent_logo_url.blank?
                          %img.agent-logo{:alt => "agent profile photo", :src => @property.agent_logo_url}
                        - else
                          %p
                            %strong.agent-name
                              = @property.agent_name

                        %p.agent-details
                          = link_to_if @property.agent_website, @property.agent_company, @property.agent_website
                          - if @property.agent_email.present?
                            %br
                            = link_to @property.agent_email, "mailto:#{@property.agent_email}?subject=#{@property.address}"

                          - if @property.agent_phone.present?
                            %br
                            = number_to_phone(@property.agent_phone, area_code: true)

                          - if @property.agent_license.present?
                            %br
                            = @property.agent_license

                          - if @property.agent_facebook_url.present?
                            %br
                            = link_to @property.agent_facebook_url do
                              %span.fa.fa-facebook-square.fsize-30



                            -# = link_to @property.agent_facebook_url if @property.agent_facebook_url

            / Property Details Area
            #block-20d2d7d07ef691626788.sqs-block.html-block.sqs-block-html{"data-block-type" => "2"}
              .sqs-block-content
                %h1
                  - if @property.list_price
                    Purchase Price:
                    = number_to_currency(@property.list_price, precision: 0)
                  %br
                  %strong= "#{@property.sqfeet} sqft"

                / property Description
                %p= @property.description

              / Property Beds and Bath Area
              / Used when home has garage or garden
              - if @property.cars.to_i > 0 || @property.garden == 'yes'
                .row.sqs-row.home-icons-row.text-align-center
                  .col.sqs-col-2.span-2.home-icon-div
                    #block-yui_3_17_2_30_1441942307387_44722.sqs-block.image-block.sqs-block-image{"data-block-type" => "5"}
                      .sqs-block-content
                        .image-block-outer-wrapper.layout-caption-below
                          .intrinsic{:style => "max-width:117.0px;"}
                            .image-block-wrapper
                              %i.fa.fa-bed.home-icon
                            .image-caption-wrapper
                              .image-caption
                                %h1.home-icon-text= pluralize(@property.beds, 'Bed')
                  .col.sqs-col-2.span-2.home-icon-div
                    #block-yui_3_17_2_10_1441907369577_43072.sqs-block.image-block.sqs-block-image{"data-block-type" => "5"}
                      .sqs-block-content
                        .image-block-outer-wrapper.layout-caption-below
                          .intrinsic{:style => "max-width:117.0px;"}
                            .image-block-wrapper.has-aspect-ratio{"data-description" => "<h1>   4 Bath</h1>"}
                              %span.glyphicon.glyphicon-tint.home-icon{"aria-hidden" => "true"}
                            .image-caption-wrapper
                              .image-caption
                                %h1.home-icon-text= pluralize(@property.baths, 'Bath')
                  -if @property.cars.to_i > 0
                    .col.sqs-col-2.span-2.home-icon-div
                      #block-yui_3_17_2_30_1441942307387_44722.sqs-block.image-block.sqs-block-image{"data-block-type" => "5"}
                        .sqs-block-content
                          .image-block-outer-wrapper.layout-caption-below
                            .intrinsic{:style => "max-width:117.0px;"}
                              .image-block-wrapper{"data-description" => "<h1>4 Bed</h1>"}
                                %i.fa.fa-car.home-icon
                              .image-caption-wrapper
                                .image-caption
                                  %h1.home-icon-text Garage

                  - if @property.garden == "yes"
                    .col.sqs-col-2.span-2.home-icon-div
                      #block-yui_3_17_2_30_1441942307387_44722.sqs-block.image-block.sqs-block-image{"data-block-type" => "5"}
                        .sqs-block-content
                          .image-block-outer-wrapper.layout-caption-below
                            .intrinsic{:style => "max-width:117.0px;"}
                              .image-block-wrapper{"data-description" => "<h1>4 Bed</h1>"}
                                %i.fa.fa-tree.home-icon
                              .image-caption-wrapper
                                .image-caption
                                  %h1.home-icon-text Garden
                    .col.sqs-col-8.span-8
              - else
                .row.sqs-row
                  .col.sqs-col-2.span-2
                    #block-yui_3_17_2_30_1441942307387_44722.sqs-block.image-block.sqs-block-image{"data-block-type" => "5"}
                      .sqs-block-content
                        .image-block-outer-wrapper.layout-caption-below
                          .intrinsic{:style => "max-width:117.0px;"}
                            .image-block-wrapper{"data-description" => "<h1>4 Bed</h1>", :style => "padding-bottom:60.68376159667969%;"}
                              %noscript
                                %img{:alt => "4 Bed", :src => "http://static1.squarespace.com/static/55f1b3d9e4b018d42078c7ec/t/55f256f4e4b0f5b52b4a1449/1441945332772/"}/
                              %img.thumb-image{:alt => "4 Bed", "data-image" => "http://static1.squarespace.com/static/55f1b3d9e4b018d42078c7ec/t/55f256f4e4b0f5b52b4a1449/1441945332772/", "data-image-dimensions" => "117x71", "data-image-focal-point" => "0.5,0.5", "data-image-id" => "55f256f4e4b0f5b52b4a1449", "data-load" => "false", "data-src" => "http://static1.squarespace.com/static/55f1b3d9e4b018d42078c7ec/t/55f256f4e4b0f5b52b4a1449/1441945332772/", "data-type" => "image", :src => "http://static1.squarespace.com/static/55f1b3d9e4b018d42078c7ec/t/55f256f4e4b0f5b52b4a1449/1441945332772/"}/
                            .image-caption-wrapper.bed-bath-icon
                              .image-caption
                                %h1= pluralize(@property.beds, 'Bed')
                  .col.sqs-col-2.span-2
                    #block-yui_3_17_2_10_1441907369577_43072.sqs-block.image-block.sqs-block-image{"data-block-type" => "5"}
                      .sqs-block-content
                        .image-block-outer-wrapper.layout-caption-below
                          .intrinsic{:style => "max-width:117.0px;"}
                            .image-block-wrapper.has-aspect-ratio{"data-description" => "<h1>   4 Bath</h1>", :style => "padding-bottom:60.68376159667969%;"}
                              %noscript
                                %img{:alt => "   4 Bath", :src => "http://static1.squarespace.com/static/55f1b3d9e4b018d42078c7ec/t/55f2561be4b0f5b52b4a112d/1441945115601/"}/
                              %img{:alt => "   4 Bath", "data-image" => "http://static1.squarespace.com/static/55f1b3d9e4b018d42078c7ec/t/55f2561be4b0f5b52b4a112d/1441945115601/", "data-image-dimensions" => "117x71", "data-image-focal-point" => "0.5,0.5", "data-image-id" => "55f2561be4b0f5b52b4a112d", "data-load" => "false", "data-src" => "http://static1.squarespace.com/static/55f1b3d9e4b018d42078c7ec/t/55f2561be4b0f5b52b4a112d/1441945115601/", "data-type" => "image", :src => "http://static1.squarespace.com/static/55f1b3d9e4b018d42078c7ec/t/55f2561be4b0f5b52b4a112d/1441945115601/", :xclass => "thumb-image"}/
                            .image-caption-wrapper.bed-bath-icon
                              .image-caption
                                %h1= pluralize(@property.baths, 'Bath')
                  .col.sqs-col-8.span-8

            / Photo Gallery area
            .sqs-row
              .col-md-12
                .row.gallery-row
                  - @photos.each do |photo|
                    %a.col-sm-4.gallery-thumb-link{"data-gallery" => "multiimages", "data-toggle" => "lightbox", :href => "#{photo.url}"}
                      %img.img-responsive{:src => "#{photo.url}", :alt => "property photo"}

            / Disclosures Gallery area
            - if @disclosures.any?
              .sqs-row
                .col-md-12
                  .row.gallery-row.mt50
                    .col.sqs-col-4.span-4.col-sm-offset-4
                      #block-yui_3_17_2_1_1410979096848_6610.sqs-block.button-block.sqs-block-button{"data-block-type" => "53"}
                        .sqs-block-content
                          - if current_user
                            / Disclosures Button
                            .sqs-block-button-container--right{"data-target" => "#myModal", "data-toggle" => "modal", :type => "button"}
                              %button.sqs-block-button-element--small.sqs-block-button-element{:href => "#{@property.agent_website}"}
                                Download Disclosures
                          - else
                            / Login Button
                            .sqs-block-button-container--right{:type => "button"}
                              %a.sqs-block-button-element--small.sqs-block-button-element{:href => "/signin"}
                                Sign in to view disclosures

                    -# Modal content: Only shown on modal popup
                    #myModal.modal.inmodal.fade{"aria-hidden" => "true", :role => "dialog", :tabindex => "-1"}
                      .modal-dialog.disclosures-modal
                        .modal-content.animated.bounceInRight
                          -# TODO figure out how to download all documents at once
                          -# .modal-header
                          -#   %button.close{"data-dismiss" => "modal", :type => "button"}
                          -#     %span{"aria-hidden" => "true"} ×
                          -#     %span.sr-only Close
                            -# %h4.modal-title
                            -#   #block-yui_3_17_2_1_1410979096848_6610.sqs-block.button-block.sqs-block-button
                            -#     .sqs-block-content
                            -#       .sqs-block-button-container--left
                            -#         / Disclosures Button
                            -#         %button.sqs-block-button-element--small.sqs-block-button-element{:href => "#"}
                            -#           Download All Disclosures
                          .modal-body
                            #disclosures
                              - if @disclosures
                                - @disclosures.each do |disclosure|
                                  .col-lg-3.col-md-4.col-sm-6.disclosure
                                    .well
                                      .widget.style1.navy-bg
                                        .row
                                          .col-xs-2
                                            = link_to disclosure.url, :target => "_blank" do
                                              %i{:class => "fa fa-file-#{disclosure.file_type}-o fsize-40 file-icon"}
                                          .col-xs-10.text-right
                                            %span= link_to disclosure.title, disclosure.url, :target => "_blank", :class => "reposal", :data => { :disclosure_id => disclosure.id }

                          .modal-footer
                            #block-yui_3_17_2_1_1410979096848_6610.sqs-block.button-block.sqs-block-button
                              .sqs-block-content
                                .sqs-block-button-container--left
                                  / Disclosures Button
                                  %button.sqs-block-button-element--small.sqs-block-button-element.close-button{"data-dismiss" => "modal", :type => "button"} Close


-# Best attempt to manage section background
:javascript
  // Creating a download record in the database
  $(".reposal").click(function(){
    var disclosureId = $(this).attr("data-disclosure-id")
    console.log("#{current_user.try(:email)} is downloading: " + disclosureId)
    $.ajax({
      type: "POST",
      beforeSend: function(xhr) {xhr.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content'))},
      url: "/users/#{current_user.try(:id)}/properties/#{@property.try(:id)}/downloads?disclosure_id=" + disclosureId
    })
  })



  var imageWidth = document.getElementById('main-background').naturalWidth;
  var divWidth = $('#property #thumbnail').width();

    if (imageWidth < divWidth) {
      console.log("image is narrower than div!")
      $('#main-background').css('width', "100%");
      $('#main-background').css('position', "relative");
      $('#main-background').css('bottom', "200px");
    } else if(imageWidth > divWidth) {
      console.log("image is wider than div!")
      $('#main-background').css('width', "100%");
    }
